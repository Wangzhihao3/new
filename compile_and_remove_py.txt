import compileall
import os
import shutil

def compile_project(root_dir):
    print(f"ğŸ“¦ ç¼–è¯‘ {root_dir} ä¸­çš„æ‰€æœ‰ .py æ–‡ä»¶ä¸º .pyc ...")
    compileall.compile_dir(root_dir, force=True, quiet=True)

def move_pyc_files(root_dir):
    print("ğŸ“‚ å°† __pycache__ ä¸­çš„ .pyc ç§»åŠ¨åˆ°æºç›®å½• ...")
    for dirpath, dirnames, filenames in os.walk(root_dir):
        for dirname in dirnames:
            if dirname == '__pycache__':
                cache_dir = os.path.join(dirpath, dirname)
                for filename in os.listdir(cache_dir):
                    if filename.endswith('.pyc'):
                        # åŸå§‹æ–‡ä»¶åï¼šmodule.cpython-39.pyc -> module.pyc
                        original_name = filename.split('.')[0] + '.pyc'
                        src = os.path.join(cache_dir, filename)
                        dst = os.path.join(dirpath, original_name)
                        shutil.copy2(src, dst)
                shutil.rmtree(cache_dir)

def delete_py_files(root_dir):
    print("ğŸ§¹ åˆ é™¤æ‰€æœ‰ .py æ–‡ä»¶ï¼ˆä¿ç•™ __init__.pyï¼‰ ...")
    for dirpath, dirnames, filenames in os.walk(root_dir):
        for filename in filenames:
            if filename.endswith('.py') and filename != '__init__.py':
                file_path = os.path.join(dirpath, filename)
                os.remove(file_path)

if __name__ == '__main__':
    root = os.path.dirname(os.path.abspath(__file__))
    compile_project(root)
    move_pyc_files(root)
    delete_py_files(root)
    print("âœ… å®Œæˆï¼å·²ç”Ÿæˆ .pyc å¹¶åˆ é™¤ .py æ–‡ä»¶ã€‚")
2